---
- name: Validate required variables
  ansible.builtin.assert:
    that:
      - vps_app_user is defined
      - vps_app_user | length > 0
      - vps_timezone is defined
      - vps_timezone | length > 0
      - vps_locale is defined
      - vps_locale | length > 0
    fail_msg: "Required variables 'vps_app_user', 'vps_timezone', and 'vps_locale' must be defined"

- name: Include system update tasks
  ansible.builtin.include_tasks: system.yml
  tags:
    - system
    - update

- name: Include user management tasks
  ansible.builtin.include_tasks: users.yml
  tags:
    - users

- name: Include SSH configuration tasks
  ansible.builtin.include_tasks: ssh.yml
  tags:
    - ssh
    - security

- name: Include firewall configuration tasks
  ansible.builtin.include_tasks: firewall.yml
  tags:
    - firewall
    - security

- name: Include fail2ban configuration tasks
  ansible.builtin.include_tasks: fail2ban.yml
  tags:
    - fail2ban
    - security

- name: Include automatic updates configuration
  ansible.builtin.include_tasks: updates.yml
  tags:
    - updates
    - security
  when: vps_auto_updates_enabled | bool
